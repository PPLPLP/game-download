<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Download Hub</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#6ee7b7;
      --muted:#94a3b8;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#071427 0%, var(--bg) 100%);
      color:#e6eef6;
      padding:24px;
    }
    header{
      display:flex;
      gap:16px;
      align-items:center;
      margin-bottom:18px;
    }
    header h1{
      margin:0;
      font-size:20px;
    }
    .container{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:20px;
    }
    /* left: game list */
    .games{
      display:grid;
      gap:12px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      border-radius:12px;
      padding:12px;
      display:flex;
      gap:12px;
      align-items:center;
    }
    .thumb{
      width:96px;
      height:64px;
      border-radius:8px;
      background:linear-gradient(90deg,#0f1724,#0b2840);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:var(--muted);
      overflow:hidden;
    }
    .meta{flex:1}
    .meta h3{margin:0 0 6px 0;font-size:16px}
    .meta p{margin:0;font-size:13px;color:var(--muted)}
    .meta .small{font-size:12px;color:var(--muted);margin-top:6px}
    .actions{display:flex;gap:8px;align-items:center}
    .btn{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:inherit;
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
      font-size:13px;
    }
    .btn.primary{
      background:linear-gradient(90deg,var(--accent),#3ee0c6);
      color:#02211a;
      border:none;
      font-weight:600;
    }
    /* right: form */
    .panel{
      background:var(--card);
      border-radius:12px;
      padding:14px;
      border:1px solid rgba(255,255,255,0.03);
    }
    .panel h2{margin:0 0 12px 0;font-size:16px}
    .field{display:flex;flex-direction:column;margin-bottom:10px}
    .field label{font-size:13px;color:var(--muted);margin-bottom:6px}
    .field input[type="text"], .field textarea, .field input[type="url"], .field input[type="file"], .field select{
      padding:8px 10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:inherit;
      font-size:13px;
    }
    textarea{min-height:80px;resize:vertical}
    .note{font-size:12px;color:var(--muted)}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    @media(max-width:900px){
      .container{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header>
    <h1>Game Download Hub</h1>
    <div style="margin-left:auto;color:var(--muted)">Local demo — no server</div>
  </header>

  <div class="container">
    <main>
      <section>
        <h2 style="margin:0 0 10px 0">รายการเกม</h2>
        <div id="games" class="games">
          <!-- cards injected here -->
        </div>
        <div style="margin-top:12px" id="emptyHint" class="note">ยังไม่มีเกม — เพิ่มเกมจากฝั่งขวา</div>
      </section>
    </main>

    <aside>
      <div class="panel">
        <h2>เพิ่มเกมใหม่</h2>

        <div class="field">
          <label>ชื่อเกม</label>
          <input id="title" type="text" placeholder="เช่น My Awesome Game" />
        </div>

        <div class="field">
          <label>คำอธิบายสั้น</label>
          <input id="desc" type="text" placeholder="คำอธิบายสั้น ๆ" />
        </div>

        <div class="field">
          <label>ขนาด (เช่น 120 MB)</label>
          <input id="size" type="text" placeholder="เช่น 120 MB" />
        </div>

        <div class="field">
          <label>ภาพย่อ (URL) — ใส่หรือปล่อยว่างระบบจะสร้างภาพอักษร</label>
          <input id="thumbUrl" type="url" placeholder="https://example.com/thumb.jpg (optional)" />
        </div>

        <div class="field">
          <label>ดาวน์โหลดจาก (เลือกได้)</label>
          <select id="sourceType">
            <option value="file">อัปโหลดไฟล์จากเครื่อง (จะสร้างลิงก์ดาวน์โหลดชั่วคราว)</option>
            <option value="url">ใช้ลิงก์ดาวน์โหลดภายนอก (URL)</option>
          </select>
        </div>

        <div class="field" id="fileField">
          <label>เลือกไฟล์เกม (.zip, .exe, .apk ฯลฯ)</label>
          <input id="fileInput" type="file" />
          <div class="note">ไฟล์จะไม่ถูกอัปโหลดไปเซิร์ฟเวอร์ — จะถูกสร้างเป็นลิงก์ชั่วคราวในหน้าเดียวนี้</div>
        </div>

        <div class="field" id="urlField" style="display:none">
          <label>URL ดาวน์โหลด (เช่น direct link)</label>
          <input id="downloadUrl" type="url" placeholder="https://example.com/mygame.zip" />
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="addBtn" class="btn primary">เพิ่มเกม</button>
          <button id="clearBtn" class="btn">ล้างฟอร์ม</button>
        </div>

        <footer>
          <div class="note">หมายเหตุ: ถ้าต้องการให้ไฟล์อยู่บนอินเทอร์เน็ตจริง ๆ โปรดใช้เซิร์ฟเวอร์หรือบริการเก็บไฟล์ (เช่น S3, Google Drive แบบแชร์ลิงก์, หรือโฮสต์ของคุณเอง)</div>
        </footer>
      </div>
    </aside>
  </div>

  <script>
    // โครงข้อมูลเกม
    const GAMES_KEY = 'gamehub_games_v1';

    function uid(){
      return 'g_' + Math.random().toString(36).slice(2,9);
    }

    function loadGames(){
      try{
        return JSON.parse(localStorage.getItem(GAMES_KEY) || '[]');
      }catch(e){ return [] }
    }

    function saveGames(games){
      localStorage.setItem(GAMES_KEY, JSON.stringify(games));
    }

    // render
    function render(){
      const games = loadGames();
      const container = document.getElementById('games');
      container.innerHTML = '';
      const emptyHint = document.getElementById('emptyHint');
      emptyHint.style.display = games.length ? 'none' : 'block';

      games.forEach(g=>{
        const card = document.createElement('div');
        card.className = 'card';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        if(g.thumbUrl){
          const img = document.createElement('img');
          img.src = g.thumbUrl;
          img.alt = g.title;
          img.style.width='100%';
          img.style.height='100%';
          img.style.objectFit='cover';
          thumb.appendChild(img);
        } else {
          thumb.textContent = (g.title||'').split(' ').map(s=>s[0]||'').slice(0,2).join('').toUpperCase();
        }

        const meta = document.createElement('div');
        meta.className = 'meta';
        const h3 = document.createElement('h3'); h3.textContent = g.title || 'ไม่ระบุ';
        const p = document.createElement('p'); p.textContent = g.desc || '';
        const small = document.createElement('div'); small.className = 'small'; small.textContent = g.size ? `ขนาด: ${g.size}` : '';

        meta.appendChild(h3); meta.appendChild(p); meta.appendChild(small);

        const actions = document.createElement('div');
        actions.className = 'actions';

        // Download button
        const dl = document.createElement('a');
        dl.className = 'btn primary';
        dl.textContent = 'ดาวน์โหลด';
        dl.href = g.downloadHref;
        dl.download = g.filename || '';
        dl.target = '_blank';
        // If downloadHref is blob URL, anchor will work. If it's external, open new tab.

        // Remove button
        const rm = document.createElement('button');
        rm.className = 'btn';
        rm.textContent = 'ลบ';
        rm.onclick = ()=>{
          if(confirm('ลบเกม "'+g.title+'" จริงหรือไม่?')){
            removeGame(g.id);
          }
        };

        actions.appendChild(dl);
        actions.appendChild(rm);

        card.appendChild(thumb);
        card.appendChild(meta);
        card.appendChild(actions);

        container.appendChild(card);
      });
    }

    function removeGame(id){
      let games = loadGames();
      const removed = games.find(g=>g.id===id);
      // revoke blob url if exists
      if(removed && removed._isObjectURL) URL.revokeObjectURL(removed.downloadHref);
      games = games.filter(g=>g.id!==id);
      saveGames(games);
      render();
    }

    // form handling
    document.getElementById('sourceType').addEventListener('change', e=>{
      const t = e.target.value;
      document.getElementById('fileField').style.display = t==='file' ? 'block':'none';
      document.getElementById('urlField').style.display = t==='url' ? 'block':'none';
    });

    document.getElementById('clearBtn').addEventListener('click', ()=>{
      ['title','desc','size','thumbUrl','downloadUrl'].forEach(id=>document.getElementById(id).value='');
      document.getElementById('fileInput').value = '';
    });

    document.getElementById('addBtn').addEventListener('click', async ()=>{
      const title = document.getElementById('title').value.trim();
      const desc = document.getElementById('desc').value.trim();
      const size = document.getElementById('size').value.trim();
      const thumbUrl = document.getElementById('thumbUrl').value.trim();
      const sourceType = document.getElementById('sourceType').value;

      if(!title){
        alert('กรุณาใส่ชื่อเกม');
        return;
      }

      let downloadHref = '';
      let filename = '';
      let isObjectURL = false;

      if(sourceType === 'file'){
        const fileInput = document.getElementById('fileInput');
        if(!fileInput.files.length){
          alert('กรุณาเลือกไฟล์สำหรับอัปโหลดจากเครื่อง');
          return;
        }
        const file = fileInput.files[0];
        filename = file.name;
        downloadHref = URL.createObjectURL(file); // ชั่วคราว (รีเฟรชหาย)
        isObjectURL = true;
      } else {
        const url = document.getElementById('downloadUrl').value.trim();
        if(!url){
          alert('กรุณาใส่ลิงก์ดาวน์โหลด');
          return;
        }
        downloadHref = url;
        // try to parse filename from url
        try {
          const u = new URL(url);
          filename = decodeURIComponent(u.pathname.split('/').pop() || '');
        } catch(e){}
      }

      const games = loadGames();
      const newGame = {
        id: uid(),
        title, desc, size,
        thumbUrl: thumbUrl || '',
        downloadHref,
        filename,
        _isObjectURL: isObjectURL
      };
      games.unshift(newGame);
      saveGames(games);
      render();
      // clear only inputs that make sense
      document.getElementById('title').value='';
      document.getElementById('desc').value='';
      document.getElementById('size').value='';
      document.getElementById('fileInput').value='';
      document.getElementById('downloadUrl').value='';
      document.getElementById('thumbUrl').value='';
    });

    // initial demo data (only if empty)
    (function boot(){
      if(!loadGames().length){
        const sample = [{
          id: uid(),
          title:'ตัวอย่าง: Space Runner',
          desc:'เกมแนวแข่งความเร็วในอวกาศ (ตัวอย่างไฟล์ไม่ได้ให้ดาวน์โหลดจริง)',
          size:'50 MB',
          thumbUrl:'',
          downloadHref:'https://example.com/space-runner.zip',
          filename:'space-runner.zip',
        }];
        saveGames(sample);
      }
      render();
    })();

    // revoke object URLs on unload to free memory
    window.addEventListener('beforeunload', ()=>{
      const games = loadGames();
      games.forEach(g=>{ if(g._isObjectURL) URL.revokeObjectURL(g.downloadHref); });
    });
  </script>
</body>
</html>
